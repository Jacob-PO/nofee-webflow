<!-- 🚀 노피 상품검색 v3.2 - HTML+CSS 통합 버전 -->
<!-- CSS 파일 없이 모든 스타일 포함, 안정적인 상품 클릭 -->

<style>
/* 🎨 완전 독립적인 고급스러운 스타일 - 웹플로우 무시 */
.nofee-v3 {
    /* 기본 리셋 */
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    
    /* 웹플로우 완전 무시 */
    position: relative !important;
    z-index: 999 !important;
    width: 100% !important;
    min-height: 100vh !important;
    
    /* 고급스러운 배경 */
    background: linear-gradient(135deg, 
        #667eea 0%, 
        #764ba2 25%, 
        #f093fb 50%, 
        #f5576c 75%, 
        #4facfe 100%) !important;
    background-size: 400% 400% !important;
    animation: gradientShift 15s ease infinite !important;
    
    /* 기본 폰트 */
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Pretendard', system-ui, sans-serif !important;
    color: #ffffff !important;
    line-height: 1.6 !important;
    
    /* 완전 표시 */
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 * {
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* 🌈 애니메이션 */
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulseGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); }
    50% { box-shadow: 0 0 40px rgba(255, 255, 255, 0.3); }
}

/* 🏗️ 메인 컨테이너 */
.nofee-v3 .main-container {
    max-width: 1400px !important;
    margin: 0 auto !important;
    padding: 40px 20px !important;
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* 🎯 헤더 섹션 */
.nofee-v3 .hero-section {
    text-align: center !important;
    margin-bottom: 60px !important;
    animation: slideInUp 0.8s ease-out !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .hero-title {
    font-size: 4rem !important;
    font-weight: 800 !important;
    margin-bottom: 20px !important;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .hero-subtitle {
    font-size: 1.5rem !important;
    font-weight: 300 !important;
    opacity: 0.9 !important;
    margin-bottom: 40px !important;
    color: rgba(255, 255, 255, 0.9) !important;
    visibility: visible !important;
    display: block !important;
}

/* 🎛️ 필터 카드 */
.nofee-v3 .filter-card {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border-radius: 24px !important;
    padding: 40px !important;
    margin-bottom: 40px !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1) !important;
    animation: slideInUp 0.8s ease-out 0.2s both !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .filter-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important;
    gap: 20px !important;
    margin-bottom: 30px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .filter-group {
    position: relative !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

/* 🎨 시스템 기본 Select 스타일 */
.nofee-v3 .filter-select {
    width: 100% !important;
    padding: 18px 24px !important;
    background: rgba(255, 255, 255, 0.15) !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 16px !important;
    color: white !important;
    font-size: 16px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    opacity: 1 !important;
    visibility: visible !important;
    outline: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='white' d='M2 0L0 2h4zM2 5L0 3h4z'/></svg>") !important;
    background-repeat: no-repeat !important;
    background-position: right 20px center !important;
    background-size: 12px !important;
    padding-right: 50px !important;
}

.nofee-v3 .filter-select:hover {
    background: rgba(255, 255, 255, 0.25) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2) !important;
}

.nofee-v3 .filter-select:focus {
    background: rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.6) !important;
    box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1) !important;
}

.nofee-v3 .filter-select option {
    background: #333 !important;
    color: white !important;
    padding: 12px !important;
    font-weight: 500 !important;
}

/* 🏷️ 활성 필터 태그 */
.nofee-v3 .active-filters {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 12px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .filter-tag {
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 8px 16px !important;
    background: linear-gradient(135deg, #5c27fe, #7c3aed) !important;
    color: white !important;
    border-radius: 25px !important;
    font-size: 14px !important;
    font-weight: 600 !important;
    box-shadow: 0 4px 15px rgba(92, 39, 254, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .filter-remove {
    cursor: pointer !important;
    font-weight: bold !important;
    font-size: 16px !important;
    opacity: 0.8 !important;
    visibility: visible !important;
    transition: opacity 0.2s ease !important;
}

.nofee-v3 .filter-remove:hover {
    opacity: 1 !important;
}

/* 📊 상품 카운터 */
.nofee-v3 .product-counter {
    text-align: center !important;
    margin-bottom: 40px !important;
    animation: slideInUp 0.8s ease-out 0.4s both !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .counter-text {
    font-size: 1.2rem !important;
    font-weight: 600 !important;
    color: rgba(255, 255, 255, 0.9) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: inline !important;
}

.nofee-v3 .counter-number {
    font-size: 2rem !important;
    font-weight: 800 !important;
    color: #ffffff !important;
    margin: 0 8px !important;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: inline !important;
}

/* 🎴 상품 그리드 */
.nofee-v3 .products-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)) !important;
    gap: 30px !important;
    margin-bottom: 60px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .product-card {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border-radius: 24px !important;
    padding: 32px !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    cursor: pointer !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    animation: slideInUp 0.6s ease-out both !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
    position: relative !important;
    overflow: hidden !important;
    user-select: none !important;
}

.nofee-v3 .product-card::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%) !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
    z-index: 1 !important;
}

.nofee-v3 .product-card:hover {
    transform: translateY(-8px) !important;
    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}

.nofee-v3 .product-card:hover::before {
    opacity: 1 !important;
}

.nofee-v3 .product-card:active {
    transform: translateY(-6px) scale(0.98) !important;
}

.nofee-v3 .product-header {
    display: flex !important;
    align-items: center !important;
    gap: 20px !important;
    margin-bottom: 24px !important;
    position: relative !important;
    z-index: 2 !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .brand-icon {
    width: 60px !important;
    height: 60px !important;
    border-radius: 16px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-weight: 800 !important;
    font-size: 24px !important;
    color: white !important;
    flex-shrink: 0 !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2) !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .brand-icon.samsung {
    background: linear-gradient(135deg, #1f4e8c, #2b6cb0) !important;
}

.nofee-v3 .brand-icon.apple {
    background: linear-gradient(135deg, #333, #666) !important;
}

.nofee-v3 .brand-icon.etc {
    background: linear-gradient(135deg, #6b46c1, #9333ea) !important;
}

.nofee-v3 .product-info {
    flex: 1 !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .product-title {
    font-size: 1.4rem !important;
    font-weight: 700 !important;
    color: white !important;
    margin-bottom: 12px !important;
    line-height: 1.3 !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .product-meta {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .meta-tag {
    padding: 6px 12px !important;
    background: rgba(255, 255, 255, 0.2) !important;
    color: white !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    border-radius: 20px !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: inline-block !important;
}

/* 💰 가격 섹션 */
.nofee-v3 .price-section {
    position: relative !important;
    z-index: 2 !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .price-breakdown {
    margin-bottom: 20px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .price-row {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 12px 0 !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    color: rgba(255, 255, 255, 0.9) !important;
    font-weight: 500 !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .price-row:last-child {
    border-bottom: none !important;
}

.nofee-v3 .price-total {
    background: linear-gradient(135deg, #5c27fe, #7c3aed) !important;
    border-radius: 16px !important;
    padding: 20px !important;
    text-align: center !important;
    box-shadow: 0 8px 30px rgba(92, 39, 254, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .price-label {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: rgba(255, 255, 255, 0.8) !important;
    margin-bottom: 8px !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .price-value {
    font-size: 2rem !important;
    font-weight: 800 !important;
    color: white !important;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

/* ⚡ 로딩 상태 */
.nofee-v3 .loading-state {
    text-align: center !important;
    padding: 80px 20px !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .loading-spinner {
    width: 60px !important;
    height: 60px !important;
    border: 4px solid rgba(255, 255, 255, 0.2) !important;
    border-top: 4px solid white !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
    margin: 0 auto 30px !important;
    opacity: 1 !important;
    visibility: visible !important;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.nofee-v3 .loading-text {
    font-size: 1.2rem !important;
    font-weight: 600 !important;
    color: rgba(255, 255, 255, 0.9) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

/* 🚫 에러 상태 */
.nofee-v3 .error-state {
    text-align: center !important;
    padding: 80px 20px !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .error-icon {
    font-size: 4rem !important;
    margin-bottom: 20px !important;
    opacity: 0.8 !important;
    visibility: visible !important;
}

.nofee-v3 .error-title {
    font-size: 1.8rem !important;
    font-weight: 700 !important;
    color: white !important;
    margin-bottom: 16px !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .error-message {
    font-size: 1.1rem !important;
    color: rgba(255, 255, 255, 0.8) !important;
    margin-bottom: 30px !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.nofee-v3 .retry-button {
    padding: 16px 32px !important;
    background: linear-gradient(135deg, #5c27fe, #7c3aed) !important;
    color: white !important;
    border: none !important;
    border-radius: 12px !important;
    font-size: 16px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 8px 25px rgba(92, 39, 254, 0.3) !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.nofee-v3 .retry-button:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 12px 35px rgba(92, 39, 254, 0.4) !important;
}

/* 📱 반응형 디자인 */
@media (max-width: 768px) {
    .nofee-v3 .main-container {
        padding: 20px 16px !important;
    }
    
    .nofee-v3 .hero-title {
        font-size: 2.5rem !important;
    }
    
    .nofee-v3 .hero-subtitle {
        font-size: 1.2rem !important;
    }
    
    .nofee-v3 .filter-grid {
        grid-template-columns: 1fr !important;
    }
    
    .nofee-v3 .products-grid {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
    }
    
    .nofee-v3 .filter-card,
    .nofee-v3 .product-card {
        padding: 24px !important;
    }
}
</style>

<!-- 🎯 메인 HTML 구조 -->
<div class="nofee-v3">
    <div class="main-container">
        <!-- 🎯 히어로 섹션 -->
        <div class="hero-section">
            <h1 class="hero-title">노피 상품 검색</h1>
            <p class="hero-subtitle">원하는 조건으로 최적의 휴대폰 요금제를 찾아보세요</p>
        </div>
        
        <!-- 🎛️ 필터 카드 - 시스템 기본 Select 사용 -->
        <div class="filter-card">
            <div class="filter-grid">
                <!-- 통신사 필터 -->
                <div class="filter-group">
                    <select class="filter-select" id="carrierFilter" data-category="carrier">
                        <option value="">통신사 선택</option>
                        <option value="SKT">SK텔레콤</option>
                        <option value="KT">KT</option>
                        <option value="LGU">LG유플러스</option>
                    </select>
                </div>
                
                <!-- 제조사 필터 -->
                <div class="filter-group">
                    <select class="filter-select" id="brandFilter" data-category="brand">
                        <option value="">제조사 선택</option>
                        <option value="삼성">삼성</option>
                        <option value="애플">애플</option>
                    </select>
                </div>
                
                <!-- 가입유형 필터 -->
                <div class="filter-group">
                    <select class="filter-select" id="typeFilter" data-category="type">
                        <option value="">가입유형 선택</option>
                        <option value="번호이동">번호이동</option>
                        <option value="기기변경">기기변경</option>
                        <option value="신규가입">신규가입</option>
                    </select>
                </div>
                
                <!-- 개통옵션 필터 -->
                <div class="filter-group">
                    <select class="filter-select" id="supportFilter" data-category="support">
                        <option value="">개통옵션 선택</option>
                        <option value="공시지원">공시지원</option>
                        <option value="선택약정">선택약정</option>
                    </select>
                </div>
                
                <!-- 정렬 필터 -->
                <div class="filter-group">
                    <select class="filter-select" id="sortFilter" data-category="sort">
                        <option value="">정렬 선택</option>
                        <option value="asc">월납부금 낮은순</option>
                        <option value="desc">월납부금 높은순</option>
                        <option value="discount">할인율 높은순</option>
                    </select>
                </div>
            </div>
            
            <!-- 활성 필터 -->
            <div class="active-filters" id="activeFilters"></div>
        </div>
        
        <!-- 📊 상품 카운터 -->
        <div class="product-counter">
            <span class="counter-text">총</span>
            <span class="counter-number" id="productCount">0</span>
            <span class="counter-text">개 상품</span>
        </div>
        
        <!-- 🎴 상품 그리드 -->
        <div class="products-grid" id="productList">
            <!-- 초기 로딩 상태 -->
            <div class="loading-state" style="grid-column: 1 / -1;">
                <div class="loading-spinner"></div>
                <div class="loading-text">상품 데이터를 불러오는 중...</div>
            </div>
        </div>
        
        <!-- 더보기 버튼 -->
        <div style="text-align: center; margin-top: 40px;" id="loadMore">
            <button class="retry-button" id="loadMoreBtn" style="display: none;">
                상품 더 보기
            </button>
        </div>
    </div>
</div>

<!-- 🚀 기본 JavaScript - Select 이벤트 + 안정적인 상품 클릭 -->
<script>
(function() {
    'use strict';
    
    console.log('🚀 노피 v3.2 - HTML+CSS 통합 버전 시작');
    
    // 🎯 Select 이벤트 리스너 등록
    function initSelectFilters() {
        const filterSelects = document.querySelectorAll('.nofee-v3 .filter-select');
        
        filterSelects.forEach(select => {
            select.addEventListener('change', function() {
                const category = this.dataset.category;
                const value = this.value;
                
                console.log(`🔍 필터 선택: ${category} = ${value || '전체'}`);
                
                // 외부 필터 함수 호출 (GitHub JS에서 제공)
                if (window.applyFilter) {
                    window.applyFilter(category, value);
                } else {
                    console.log('⏳ applyFilter 함수 대기 중...');
                }
            });
        });
        
        console.log('🎮 Select 필터 이벤트 리스너 설정 완료');
    }
    
    // 📱 상품 클릭 이벤트 위임 (안정적인 버전)
    function initProductClickHandler() {
        document.addEventListener('click', function(e) {
            const productCard = e.target.closest('.product-card');
            if (!productCard) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            console.log('📱 상품 카드 클릭 감지');
            
            // 상품 데이터 추출 (data 속성에서)
            try {
                const productData = extractProductDataFromCard(productCard);
                
                if (productData && productData.model) {
                    console.log('📦 추출된 상품 데이터:', productData);
                    goToAIPage(productData);
                } else {
                    console.error('❌ 상품 데이터 추출 실패 - DOM에서 직접 추출 시도');
                    // DOM에서 직접 추출 시도
                    const fallbackData = extractProductDataFromDOM(productCard);
                    if (fallbackData && fallbackData.model) {
                        console.log('🔄 DOM에서 직접 추출 성공:', fallbackData);
                        goToAIPage(fallbackData);
                    } else {
                        console.error('💥 모든 데이터 추출 방법 실패');
                    }
                }
            } catch (error) {
                console.error('❌ 상품 클릭 처리 오류:', error);
            }
        });
        
        console.log('📱 상품 클릭 이벤트 리스너 설정 완료');
    }
    
    // 🎯 상품 데이터 추출 (data 속성에서)
    function extractProductDataFromCard(productCard) {
        try {
            const data = {};
            
            // data 속성에서 추출
            const dataset = productCard.dataset;
            if (dataset && Object.keys(dataset).length > 0) {
                Object.keys(dataset).forEach(key => {
                    data[key] = decodeURIComponent(dataset[key] || '');
                });
                
                console.log('✅ data 속성에서 추출:', data);
                return data;
            }
            
            return null;
            
        } catch (error) {
            console.error('data 속성 추출 오류:', error);
            return null;
        }
    }
    
    // 🎯 상품 데이터 추출 (DOM에서 직접)
    function extractProductDataFromDOM(productCard) {
        try {
            const data = {
                model: '',
                carrier: '',
                brand: '',
                type: '',
                support: '',
                total: '',
                plan: '',
                installment: '',
                originPrice: '',
                principal: '',
                discount: '',
                discountRate: ''
            };
            
            // 모델명 추출
            const titleElement = productCard.querySelector('.product-title');
            if (titleElement) {
                data.model = titleElement.textContent.trim();
            }
            
            // 메타 태그에서 정보 추출
            const metaTags = productCard.querySelectorAll('.meta-tag');
            if (metaTags.length >= 4) {
                data.carrier = metaTags[0].textContent.trim();
                data.brand = metaTags[1].textContent.trim();
                data.type = metaTags[2].textContent.trim();
                data.support = metaTags[3].textContent.trim();
            }
            
            // 월 납부금 추출
            const priceValueElement = productCard.querySelector('.price-value');
            if (priceValueElement) {
                data.total = priceValueElement.textContent.replace(/[^\d]/g, '');
            }
            
            // 가격 상세 정보 추출
            const priceRows = productCard.querySelectorAll('.price-row');
            priceRows.forEach(row => {
                const cells = row.children;
                if (cells.length >= 2) {
                    const label = cells[0].textContent.trim();
                    const value = cells[1].textContent.trim();
                    const numValue = value.replace(/[^\d]/g, '');
                    
                    if (label.includes('기기값')) {
                        data.originPrice = numValue;
                    } else if (label.includes('할부원금')) {
                        data.installment = numValue;
                    } else if (label.includes('요금제')) {
                        data.plan = numValue;
                    } else if (label.includes('지원금')) {
                        data.principal = numValue;
                        // 할인율 추출 (괄호 안의 퍼센트)
                        const discountMatch = value.match(/\((\d+)%\)/);
                        if (discountMatch) {
                            data.discountRate = discountMatch[1];
                        }
                        data.discount = numValue;
                    }
                }
            });
            
            console.log('✅ DOM에서 직접 추출:', data);
            return data;
            
        } catch (error) {
            console.error('DOM 직접 추출 오류:', error);
            return null;
        }
    }
    
    // 🤖 AI 페이지로 이동 함수
    function goToAIPage(productData) {
        try {
            // URL 파라미터 생성 (모든 데이터 포함)
            const params = new URLSearchParams();
            
            // 모든 필드를 URL 파라미터로 추가
            Object.entries(productData).forEach(([key, value]) => {
                if (value && value !== '') {
                    params.append(key, value);
                }
            });
            
            // 추가 메타데이터
            if (!params.has('from')) {
                params.append('from', 'search');
            }
            if (!params.has('timestamp')) {
                params.append('timestamp', Date.now().toString());
            }
            
            // localStorage에도 백업 저장
            try {
                localStorage.setItem('selectedProduct', JSON.stringify(productData));
                localStorage.setItem('selectedProductTime', Date.now().toString());
                console.log('💾 localStorage에 상품 데이터 저장 완료');
            } catch (storageError) {
                console.warn('⚠️ localStorage 저장 실패:', storageError);
            }
            
            // AI 페이지 URL 생성
            const aiUrl = `/ai?${params.toString()}`;
            
            console.log('🤖 AI 페이지로 이동:', aiUrl);
            console.log('📋 URL 파라미터 개수:', Array.from(params.keys()).length);
            console.log('📋 전체 파라미터:', Object.fromEntries(params));
            
            // 페이지 이동
            window.location.href = aiUrl;
            
        } catch (error) {
            console.error('❌ AI 페이지 이동 중 오류:', error);
            
            // 오류 시 기본 AI 페이지로 이동 (최소한의 파라미터)
            const fallbackUrl = `/ai?model=${encodeURIComponent(productData.model || '상품정보없음')}&from=search_error`;
            console.log('🔄 폴백 URL로 이동:', fallbackUrl);
            window.location.href = fallbackUrl;
        }
    }
    
    // 🎯 외부 GitHub 스크립트 로드
    function loadExternalScript() {
        const script = document.createElement('script');
        script.src = 'https://jacob-po.github.io/nofee-webflow/pages/more.js?v=' + Date.now();
        
        script.onload = function() {
            console.log('✅ GitHub 스크립트 로드 성공');
            
            setTimeout(() => {
                if (window.initProductSearch) {
                    console.log('🚀 상품 검색 초기화 시작');
                    window.initProductSearch();
                } else {
                    console.log('⏳ 초기화 함수 대기 중...');
                    setTimeout(() => {
                        if (window.initProductSearch) {
                            window.initProductSearch();
                        } else {
                            showError();
                        }
                    }, 3000);
                }
            }, 500);
        };
        
        script.onerror = function() {
            console.error('❌ GitHub 스크립트 로드 실패');
            showError();
        };
        
        document.head.appendChild(script);
        console.log('📡 GitHub 스크립트 로드 시작...');
    }
    
    // 🚫 에러 표시
    function showError() {
        const productList = document.getElementById('productList');
        if (!productList) return;
        
        productList.innerHTML = `
            <div class="error-state" style="grid-column: 1 / -1;">
                <div class="error-icon">⚠️</div>
                <h3 class="error-title">데이터 로드 실패</h3>
                <p class="error-message">네트워크 연결을 확인하고 새로고침해주세요</p>
                <button class="retry-button" onclick="location.reload()">새로고침</button>
            </div>
        `;
        
        console.log('🚫 에러 상태 표시');
    }
    
    // 🚀 초기화
    function init() {
        console.log('🎯 기본 시스템 초기화 시작');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initSelectFilters();
                initProductClickHandler();
                loadExternalScript();
            });
        } else {
            initSelectFilters();
            initProductClickHandler();
            loadExternalScript();
        }
        
        console.log('✨ 기본 UI 및 이벤트 설정 완료');
    }
    
    // 타임아웃 보호
    setTimeout(() => {
        const productList = document.getElementById('productList');
        if (productList && productList.querySelector('.loading-state')) {
            console.log('⏰ 15초 타임아웃 - 에러 표시');
            showError();
        }
    }, 15000);
    
    // 즉시 초기화
    init();
    
})();
</script>
